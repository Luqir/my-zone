import{_ as p,r as e,o,c,a as n,b as s,d as t,e as l}from"./app-04c27b99.js";const i={},u=l(`<h2 id="分析" tabindex="-1"><a class="header-anchor" href="#分析" aria-hidden="true">#</a> 分析</h2><p>1、查看视频 <strong>url</strong> 发现视频是二进制流，不能直接跳转链接下载</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>video src<span class="token operator">=</span><span class="token string">&quot;blob:xxx&quot;</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>video<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>2、观察 <strong>控制台 =&gt; 网络</strong>，发现视频是由大量 .ts 文件组合而成的，使用浏览器插件 <strong>全能视频下载终结者</strong> 进行嗅探，抓取所有 .ts 视频（其他有很多抓取视频的插件和工具，如 猫抓、IDM 等，不过大多都要视频播放了才能进行抓取）</p><p>3、下载后发现 .ts 视频播放失败，查看嗅探的 <strong>.m3u8</strong> 文件（或者从下一步中下载），发现有两个，从第一个文件的内容中的不难看出，这是个不同分辨率对应的链接文件</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>#EXTM3U
#EXT-X-STREAM-INF:PROGRAM-ID=1, BANDWIDTH=800000, NAME=&quot;720p HD&quot;
xxx_3.m3u8?pid=xxx&amp;device=desktop
#EXT-X-STREAM-INF:PROGRAM-ID=1, BANDWIDTH=512000, NAME=&quot;360p SD&quot;
xxx_2.m3u8?pid=xxx&amp;device=desktop
#EXT-X-STREAM-INF:PROGRAM-ID=1, BANDWIDTH=256000, NAME=&quot;270p 3G&quot;
xxx_1.m3u8?pid=xxx&amp;device=desktop

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4、 <strong>控制台 =&gt; 网络 =&gt; 筛选器</strong> 找到对应 <em>720p HD</em> 的 .m3u8 文件链接，下载该文件，打开查看后发现视频经过了 <strong>AES-128</strong> 加密处理，其中 <strong>KEY</strong> 密钥有对应 URI 下载链接，<strong>IV</strong> 偏移量在文件中直接提供了</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>#EXT-X-KEY:METHOD=AES-128,URI=&quot;https://xxx.key&quot;,IV=0xjjjjqqqqhhhhvvvv
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>5、直接访问 URI 失败，怀疑需要携带请求参数或者 token，<strong>筛选器</strong> 查找 key 文件，找到链接后直接访问，下载 key 文件到本地</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>xxx_3<span class="token punctuation">.</span>key<span class="token operator">?</span>token<span class="token operator">=</span>xxx<span class="token operator">-</span>xxx<span class="token operator">-</span>xxx<span class="token operator">-</span>xxx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>6、打开 <strong>KEY</strong> 文件后发现一堆乱码，猜想 key 应该是二进制文件，拖入 <strong>winHex</strong> 软件中发现有 32 个 16 进制数，而解密只需要 16 个，不懂接下来怎么处理，遂放弃从该文件中解密（有知道的怎么直接破解 key 的大神求告知）</p><h2 id="破解-key" tabindex="-1"><a class="header-anchor" href="#破解-key" aria-hidden="true">#</a> 破解 KEY</h2><p>7、查看 <strong>控制台 =&gt; 源代码</strong>，看到 <em>player.polyv.net</em>，知道这是 <strong>保利威加密</strong> ，下载其中的 <strong>player.js</strong> 文件，在下面位置中插入代码</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>yt <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">d</span><span class="token operator">:</span> <span class="token string">&#39;decryptkey&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token string">&#39;decryptdata&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token string">&#39;key&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
bt <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">b</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">t<span class="token punctuation">,</span> e<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> n <span class="token operator">=</span> t<span class="token punctuation">.</span>data<span class="token punctuation">,</span>
      r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">R</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      a <span class="token operator">=</span> At<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      o <span class="token operator">=</span> <span class="token constant">V</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
    n <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">At<span class="token punctuation">.</span>m<span class="token punctuation">.</span>c</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token constant">M</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> s <span class="token operator">=</span> i<span class="token punctuation">.</span>frag
    <span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>yt<span class="token punctuation">.</span>d<span class="token punctuation">]</span> <span class="token operator">=</span> s<span class="token punctuation">[</span>yt<span class="token punctuation">.</span>a<span class="token punctuation">]</span><span class="token punctuation">[</span>yt<span class="token punctuation">.</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">V</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span>s<span class="token punctuation">.</span>loader <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>loaders<span class="token punctuation">[</span>s<span class="token punctuation">.</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>hls<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token constant">I</span><span class="token punctuation">.</span>a<span class="token punctuation">[</span>yt<span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;_LOADED&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">frag</span><span class="token operator">:</span> s <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// ================== luqirong ==================</span>
  
    <span class="token keyword">const</span> <span class="token function-variable function">buf2hex</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">map</span>
        <span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token string">&#39;00&#39;</span> <span class="token operator">+</span> x<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39; &#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> key <span class="token operator">=</span> <span class="token function">buf2hex</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>_decryptdata<span class="token punctuation">.</span>key<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span>
    <span class="token keyword">const</span> iv <span class="token operator">=</span> <span class="token function">buf2hex</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>_decryptdata<span class="token punctuation">.</span>iv<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> key<span class="token punctuation">,</span> iv <span class="token punctuation">}</span><span class="token punctuation">)</span>
  
    <span class="token comment">// ================== luqirong ==================</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>8、使用 <strong>Fiddler</strong> 软件对 <strong>player.js</strong> 文件进行代理，刷新后控制台即可看到 key 和 iv 的输出，对比 m3u8 文件中的 iv 值发现一致，至此 key 值确认解密成功</p><h2 id="fiddler-代理" tabindex="-1"><a class="header-anchor" href="#fiddler-代理" aria-hidden="true">#</a> Fiddler 代理</h2>`,16),r={href:"https://www.cnblogs.com/liulinghua90/p/9109282.html",target:"_blank",rel:"noopener noreferrer"},k={href:"https://www.likecs.com/show-204315326.html",target:"_blank",rel:"noopener noreferrer"},d=n("h2",{id:"解密及下载",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#解密及下载","aria-hidden":"true"},"#"),s(" 解密及下载")],-1),v={href:"https://github.com/HeiSir2014/M3U8-Downloader/releases",target:"_blank",rel:"noopener noreferrer"},m=n("strong",null,"私有KEY",-1),b=n("h2",{id:"ts-文件缺失",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ts-文件缺失","aria-hidden":"true"},"#"),s(" TS 文件缺失")],-1),g=n("blockquote",null,[n("p",null,"有时候 ts 文件会少下几个，这时候要么重新新建对应任务（不要点停止重新下载，太慢了），要么单独找到那个 ts 的链接，将缺少的 ts 文件下载下来，单独进行解密")],-1),h={href:"https://www.jianshu.com/p/ff13a8ee017c",target:"_blank",rel:"noopener noreferrer"},x={href:"https://www.52pojie.cn/thread-971265-1-1.html",target:"_blank",rel:"noopener noreferrer"};function y(f,_){const a=e("ExternalLinkIcon");return o(),c("div",null,[u,n("p",null,[s("9、"),n("a",r,[s("Fiddler 抓取 HTTPS "),t(a)])]),n("p",null,[s("10、"),n("a",k,[s("Fiddler 本地代理替换 player.js 文件"),t(a)])]),d,n("p",null,[s("11、下载 "),n("a",v,[s("M3U8-Downloader v2.0.7 "),t(a)]),s("，将步骤 4 中的 m3u8 文件放入软件中，在 "),m,s(" 框中填入 KEY 和 IV 值，点击确定即可自动下载、解密、合并成 .mp4 文件，完成。")]),b,g,n("p",null,[n("a",h,[s("解密工具"),t(a)])]),n("p",null,[n("a",x,[s("解密方法"),t(a)])])])}const E=p(i,[["render",y],["__file","042001.html.vue"]]);export{E as default};
